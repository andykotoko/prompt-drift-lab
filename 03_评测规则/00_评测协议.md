# 00_评测协议（v2）

## 0. 本目录的作用（Scope & Precedence）
本目录用于冻结 Prompt Drift Lab 的评测规则与评测执行方式，确保“结果可复现、可审计、可对照”。

**优先级（非常重要）**
1) `EVAL_PROTOCOL_v2.md`：唯一的、可执行的评测规范（Rubric + JSON schema + evidence 硬约束）。  
2) `JUDGE_PROMPT_v2.md`：评测器（judge）使用的固定提示词，必须与 v2 协议一致。  
3) `01_硬性合规判定规则.md`、`02_行为表现评分维度.md`：用于解释与辅助分析；不得与 v2 协议冲突。若发生冲突，以 `EVAL_PROTOCOL_v2.md` 为准。

---

## 1. 评测对象与输入
### 1.1 被测对象（generator）
- 不同模型在同一套提示词条件下，生成的结构化“三段式输出”（PDF）。

### 1.2 输入 bundle（每次评测的最小单元）
一个 bundle = 16 个 PDF：
- questions: Q3, Q4
- versions: baseline, long, weak, conflict
- trigger_types: implicit, explicit
- 文件命名：`q{3|4} {version} {implicit|explicit}.pdf`

---

## 2. 输出产物（Artifacts）
每次评测输出 1 个 JSON，命名为：
- `judge_{judge_model}_bundle_{generator_model}_v2.json`

并放入：
- `04_实验结果/cross_model_evaluation_results/valid_results/main_method/`（通过 v2 合规检查）
- 或 `.../invalid_results/main_method/`（评测器未遵循 v2 协议导致无效）

---

## 3. 两种评测方法（Methods）
### 3.1 主方法：交叉评测（Cross-model judging）
- 使用“通过 v2 合规检查”的 judge 模型（当前：ChatGPT、Gemini）对其他 generator 的 16 个 PDF 评分。
- Claude 作为 judge 若出现协议偏移（输出不合规），该结果进入 invalid，不纳入主结论。

### 3.2 补充方法：自评（Self-judging）
- generator 对自己的 16 个 PDF 执行同一 v2 评测，输出 `self_judge_{model}.json`（建议命名）。
- 用途：一致性校验、偏差诊断；不作为主结论唯一依据。

---

## 4. 合规性与 invalid 规则（Validity）
一个 judge 输出若满足以下任一情况，判为 invalid：
- 非严格 JSON（含 Markdown/解释性文字）
- JSON schema 不匹配 / 缺字段
- evidence 违反 v2 约束（例如含 .../…、非原文、空 evidence 却给非 0 分等）
- aggregates 与 per_file_scores 不可复算一致

invalid 的结果只用于“评测器偏移”分析，不进入主方法统计。

---

## 5. 偏差控制（Bias control）
- 盲评：评测器不应看到 Prompt A/B 的标签含义（只见文件名与内容）。
- 统一 protocol：所有 judge 必须使用相同 `JUDGE_PROMPT_v2.md` 与 `EVAL_PROTOCOL_v2.md`。
- 记录元信息：模型名/版本、日期、推理模式（如 thinking/extended）、温度等（若可得）。
